# ランダム容量変動型 s–t ネットワークフロー制御モデル（LLM制御向け）

## 1. モデル概要
本モデルは、s–t（source–sink）ネットワークにおける負荷変動や災害時の経路制御を模したトイモデルである。
ネットワークは有向グラフで表され、ソースノード \( s \) からシンクノード \( t \) までの複数経路が存在する。
各エッジには容量（最大許容量）が設定され、容量は時間とともにランダムに変動し、ときに故障によりゼロになる。
エージェント（LLM）は、与えられた候補 s–t パスから経路を選び、流量を増減してフローを制御する。

---

## 2. モデル要素

### ネットワーク構造
- 有向グラフ \( G = (V, E) \)
- 特殊ノード：ソース \( s \in V \)、シンク \( t \in V \)
- s–t 間に複数の候補パス \(\mathcal{P} = \{ P_1, P_2, \dots, P_K \}\)
- 各エッジ \( e \in E \) に容量 \( c_e(t) \) と現在フロー \( f_e(t) \) を保持

### フロー制約
- **フロー保存則**（中間ノード）：
  \[
  \sum_{e \in \delta^-(v)} f_e(t) = \sum_{e \in \delta^+(v)} f_e(t), \quad \forall v \in V \setminus \{ s, t \}
  \]
  （入ってくるフロー量＝出ていくフロー量）
- **容量制約**：
  \[
  f_e(t) \leq c_e(t), \quad \forall e \in E
  \]
  ※ 本モデルでは容量制約違反を許し、その場合はアラートが発生する

---

## 3. 容量変動
- **ランダムウォーク型**：
  \[
  c_e(t+1) = \max(0,\, c_e(t) + \eta_e(t))
  \]
  \(\eta_e(t)\) はランダム変数（上下限あり）
- **故障イベント**：
  - 確率 \(p_{fail}\) で \(c_e(t) = 0\)
  - 復旧確率 \(p_{rec}\) により元の容量まで回復
  各ステップでランダムウォークに従って更新し、その後、確率\(p_{fail}\) 
  でゼロ化する

---

## 4. フロー制御
- 各ステップで LLM は以下を決定：
  1. **パス選択** \(P \in \mathcal{P}\)
  2. **増減量** \(\Delta a\)（正は増流、負は減流）
- 制御はパス単位で適用し、そのパスを構成するすべてのエッジのフローを \(\Delta a\) だけ増減する
- フロー更新は LLM が行動したときのみ発生（環境側のランダム揺らぎは容量のみに適用）

---
## 5. 観測とアラート

### アラート種別
- **overload**: 容量超過（\(f_e > c_e\)）
- **failure**: 容量ゼロ（\(c_e = 0\)）

### アラート通知のルール
- overload と failure は同格の「故障エッジ」として扱う．  
- 毎反復で，故障エッジ集合の中から最大で **L** 件のアラートが通知される．  
- Lを超える場合，通知されるエッジは一様ランダムに選ばれる．  
- 通知には自然言語表現が用いられる（例：「e12がオーバーロード」「e2が不通」など）．  


## 6. 制御目標

### 主目的
- overload/failure の発生回数や継続時間を最小化
- s–t フローの総スループット最大化(最大フロー)
- またユーザからの自然言語による目的指示に従う

---

## 7. LLM制御の特徴
- **部分情報からの推測**：
  限られた観測やアラートから未観測領域の状態を推定
- **言語的説明能力**：
  「理由付き」で経路・増減量を選択
- **逐次的判断**：
  容量変動の不確実性に対して長期的に安全性とスループットを両立

---

## 8. 実世界での対応例
| モデル要素 | 実世界の対応 |
|------------|--------------|
| 容量変動 | 通信リンク帯域変化、道路通行可能台数変化 |
| 容量ゼロ | ケーブル断線、ルーター停止、道路封鎖 |
| 部分観測 | 限定的モニタリング、災害現場の断片情報 |
| アラート | ネットワーク監視通知、現場報告 |
| 制御行動 | ルート変更、配送経路再設定 |

---

## 9. 応用シナリオ
- 通信ネットワークの輻輳制御
- 災害時の物流経路管理
- 送電網の負荷分散
- 教育用 POMDP ベンチマーク
