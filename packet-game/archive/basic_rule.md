## ゲームの概要と最終目標

このゲームは **2人のエージェント A と B が、限られた送信枠（1枠）をめぐって交渉するゲーム** です。

時刻は 1, 2, 3, … と進み、各時刻に A と B のどちらか一方のパケットだけが送信できます。

各エージェントは自分のキューに「価値」と「期限」を持ったパケットを保持しています。

パケットは時間が経つごとに期限が 1 ずつ減り、期限が 0 になるとそのパケットは失効して送れなくなります。

**ゲームの最終目標は、パケットをできるだけ多く、そして有効に送信して、全体としての価値を最大化することです。**

ただし、A と B の利益は必ずしも一致しません。

時には互いに譲り合うことで長期的な利益を得られるかもしれませんし、譲らずに即時の利益を取ることもできます。

---

## パケットの到着

- 各時刻の初めに、**必ず1つの新しいパケットが到着**します。
- **A または B のどちらか一方に到着**します（それぞれ50%の確率）。
- 新しいパケットの価値は **1 から 10 の範囲でランダム**に決まります。
- 新しいパケットの期限は **必ず 5** からスタートします。
- **注意**: パケットが到着しないターンや、両方に同時到着することはありません。

---

## 交渉と決定の流れ

1. 各エージェントは、自分のキューの中から **必ず1つのパケットを選び**「これを送りたい」とリクエストを出します。
2. **交渉が成立した場合**：
    - 両者が「A のパケットを送る」と合意したときは、A がリクエストしたパケットが送られます。
    - 両者が「B のパケットを送る」と合意したときは、B がリクエストしたパケットが送られます。
3. **交渉が成立しなかった場合**：
    - A のリクエストと B のリクエストのどちらかが **ランダムに選ばれ**、そのパケットが送られます。

---

## 送信後の処理

- 送られたパケットはキューから取り除かれます。
- 残ったパケットは **期限が 1 減ります**。
- 期限が 0 になったパケットは **失効し、二度と送れません**。

---

## 評価指標

**平均送信価値（= エピソード総価値 ÷ ターン数）**

- 目的に直結（全体価値の最大化）。
- 分布や負荷が変わっても比較しやすい（正規化される）。
- 実装も集計も簡単（足して割るだけ）。

> レポート例：avg_value_per_step = total_sent_value / H（併せて標準偏差・95%CIだけ出すと比較が安定します）
> 

---

## プレイ記録の例

以下は 4 ターン分のプレイ例です。

**ターン1（交渉不成立 → ランダム選択）**

- 到着：A に (価値=8, 期限=5)、B に (価値=4, 期限=5) が到着。
- リクエスト：A は 8 を希望、B は 4 を希望。
- 結果：交渉不成立 → コイン投げで A が選ばれ、A の 8 が送信。
- 更新：B の 4 の期限が 4 になる。

---

**ターン2（交渉成立 → B に譲る）**

- 到着：A に (価値=6, 期限=5) が到着。B には新規なし。
- 状況：A のキュー = (6,5)、B のキュー = (4,4)。
- リクエスト：A は 6 を希望、B は 4 を希望。
- 交渉：A が「自分は余裕があるから今回は譲る」と提案し、両者が B の送信に合意。
- 結果：B の 4 が送信。
- 更新：A の 6 の期限が 4 になる。

---

**ターン3（交渉成立 → A に譲る）**

- 到着：B に (価値=9, 期限=5) が到着。A には新規なし。
- 状況：A のキュー = (6,4)、B のキュー = (9,5)。
- リクエスト：A は 6 を希望、B は 9 を希望。
- 交渉：B が「自分は余裕があるから今回は譲る」と提案し、両者が A の送信に合意。
- 結果：A の 6 が送信。
- 更新：B の 9 の期限が 4 になる。

---

**ターン4（交渉不成立 → ランダム選択）**

- 到着：なし。
- 状況：B のキュー = (9,4)。
- リクエスト：A は送れるパケットがなく、強制的に「譲る」を宣言。B は 9 を希望。
- 結果：両者一致により B の 9 が送信。
- 更新：キューは空になる。

## まとめ

- 毎時刻、A と B は必ず1つのパケットを選んでリクエストします。
- 合意できればその合意に従い、合意できなければランダムで決まります。
- 価値の高いパケットや期限が迫ったパケットをどう扱うか、譲るか主張するかがゲームのポイントです。
- 目的は全体の価値を最大化しつつ、公平さや失効率も考慮することです。